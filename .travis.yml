language: cpp
compiler: gcc
os: linux
dist: trusty

before_install:
- sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
- sudo add-apt-repository --yes ppa:beineri/opt-qt-5.10.1-trusty
- sudo apt-get update -qq


install:
- sudo apt-get install -qq g++-9 tree qt510-meta-minimal libgl1-mesa-dev
- sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 90 && sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 90
- source /opt/qt5*/bin/qt5*-env.sh


before_script:
- git submodule update --init --recursive
- qmake


script:
- make -j$(nproc)
- cd packaging/
- wget -c https://github.com/probonopd/linuxdeployqt/releases/download/continuous/linuxdeployqt-continuous-x86_64.AppImage
- chmod +x linuxdeployqt-*.AppImage
- ./appimage.sh --add-libstdc++
- pwd && tree . && cd ..


deploy:
  provider: releases
  draft: true
  edge: true
  skip_cleanup: true
  #cleanup: false
  token: $GITHUB_TOKEN
  file_glob: true
  file:
    - packaging/DeepTags*.AppImage
    - packaging/DeepTags*.AppImage.zsync
  on:
    repo: SZinedine/DeepTags
    tags: false
